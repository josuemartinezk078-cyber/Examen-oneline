document.getElementById('evaluationForm').addEventListener('submit',function(e){
    e.preventDefault();

    var nombre = document.getElementById('nombre').value;
    var cedula = document.getElementById('cedula').value;
    var correo = document.getElementById('correo').value;
    var empresa = document.getElementById('empresa').value;

    var correctas = 0;
    var detalleRespuestas = "REPORTE DE EVALUACIÓN\n";
    detalleRespuestas += "Nombre: " + nombre + "\n";
    detalleRespuestas += "Cédula: " + cedula + "\n";
    detalleRespuestas += "Correo: " + correo + "\n";
    detalleRespuestas += "Empresa: " + empresa + "\n\n";
    detalleRespuestas += "DETALLE DE RESPUESTAS:\n\n";

    for(var i=0; i<preguntasSeleccionadas.length; i++){
        var p = preguntasSeleccionadas[i];
        var checked = document.querySelector('input[name="q'+p.id+'"]:checked');
        var respuestaUsuario = checked ? checked.value : "No respondió";
        var correcta = p.respuesta;

        var estado = "❌ Incorrecta";
        if(respuestaUsuario === correcta){
            correctas++;
            estado = "✅ Correcta";
        }

        detalleRespuestas += (i+1) + ". " + p.pregunta + "\n";
        detalleRespuestas += "   Respondió: " + respuestaUsuario + "\n";
        detalleRespuestas += "   Correcta: " + correcta + "\n";
        detalleRespuestas += "   Resultado: " + estado + "\n\n";
    }

    var porcentaje = (correctas/10)*100;
    var aprobado = porcentaje >= 80;

    detalleRespuestas += "----------------------------------\n";
    detalleRespuestas += "PUNTAJE: " + correctas + "/10\n";
    detalleRespuestas += "PORCENTAJE: " + porcentaje.toFixed(1) + "%\n";
    detalleRespuestas += "RESULTADO: " + (aprobado ? "APROBADO" : "REPROBADO");

    document.getElementById('evaluationForm').style.display = 'none';
    document.getElementById('resultContainer').style.display = 'block';
    document.getElementById('scoreDisplay').textContent = correctas+'/10';
    document.getElementById('scoreMessage').textContent = porcentaje.toFixed(1)+'%';
    document.getElementById('scoreBadge').textContent = aprobado ? 'APROBADO ✓' : 'REPROBADO ✗';
    document.getElementById('scoreBadge').className = 'success-badge '+(aprobado ? 'badge-aprobado' : 'badge-reprobado');

    // Generar archivo TXT automático
    var blob = new Blob([detalleRespuestas], { type: "text/plain" });
    var link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "Resultado_" + nombre.replace(/\s/g,"_") + ".txt";
    link.click();
});
